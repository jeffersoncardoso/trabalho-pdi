/*! Application - v0.0.0 - 2019-10-20 */
var PDI=function(t){function a(){this.original=new Image,this.image=new Image,this.processes={},this.grayScaleType="media",this.grid=[],this.reset()}return a.prototype={setGrayScale:function(t){this.grayScaleType=t},reset:function(){this.statistics={average:0,median:0,variance:0,moda:0,totalPx:0},this.histogram={},this.histogram.gray=Array(256).fill(0),this.histogram.rgb={r:Array(256).fill(0),g:Array(256).fill(0),b:Array(256).fill(0)},this.grid=[]},loadImagem:function(t,a){var e=this;e.original.src=URL.createObjectURL(t),e.image.src=URL.createObjectURL(t),"function"==typeof a&&(e.image.onload=function(){a(e.image),e.resetImage(),e.convertToGrid()}),this.reset()},resetImage:function(t){t&&(this.processes={});var a=document.createElement("canvas");a.width=this.original.width,a.height=this.original.height;var e=a.getContext("2d");return e.drawImage(this.original,0,0),this.image=e.getImageData(0,0,this.original.width,this.original.height),[this.image]},getImageData:function(){var t=document.createElement("canvas");if(this.image instanceof Image){var a,e=this.image;return t.width=e.width,t.height=e.height,(a=t.getContext("2d")).drawImage(e,0,0),a.getImageData(0,0,e.width,e.height)}if(this.image instanceof ImageData)return t.width=this.image.width,t.height=this.image.height,(a=t.getContext("2d")).putImageData(this.image,0,0),a.getImageData(0,0,this.image.width,this.image.height)},getPixelData:function(t,a,e){var i=e.width,n=(e.height,a*i*4+4*t);return[e.data[n],e.data[n+1],e.data[n+2],e.data[n+3],n]},applyFilter:function(){var t=Array.from(arguments),a=t.shift();return void 0===t&&(t={}),this.processes[a]=t,this.processImage()},processImage:function(){for(var t in this.resetImage(),this.processes){var a=this.processes[t];this.image=this[t].apply(this,a)[0]}return[this.image]},getStatistics:function(){return this.statistics},getHistogram:function(t){if("gray"==t)return this.filterGray(),this.histogram.gray;if("rgb"==t)for(var a=this.getImageData(),e=0;e<a.data.length;e+=4)histogram.r[a.data[e]]++,histogram.g[a.data[e+1]]++,histogram.b[a.data[e+2]]++},blankMatrix:function(t,a,e=255){var i=document.createElement("canvas");return i.width=t,i.height=a,i.getContext("2d").getImageData(0,0,t,a)},convertToGrid:function(){for(var t=this.getImageData(),a=this.image.width,e=(this.image.height,0),i=0,n=0;e<t.data.length;e+=4,i++)i==a&&(i=0,n++),void 0===this.grid[n]&&(this.grid[n]=[]),void 0===this.grid[n][i]&&(this.grid[n][i]=[]),this.grid[n][i]=[t.data[e],t.data[e+1],t.data[e+2],t.data[e+3],e]},showMatrix:function(t,a){if(a){var e=[];for(r=0;r<matrixData.length;r++){void 0==e[r]&&(e[r]=[]);for(var i=0;i<matrixData[0].length;i++){void 0==e[r][i]&&(e[r][i]=[]);var n=matrixData[r][i];e[r][i]="[ "+n.join(" ")+" ]",_this.showMatrix(e)}}}else for(var r=0;r<t.length;r++)console.log("[ "+t[r].join(" ")+" ]")},filterMatrixConvolution:function(t,a,e=null){for(var i=[0,0,0,0],n=0;n<t.length;n++)for(var r=0;r<t[0].length;r++){var s=t[n][r],h=a[n][r];s.map(function(t,a){i[a]+=t*h})}return"function"==typeof e&&(i=e(i)),i},getMatrixFromData:function(t,a,e,i,n){void 0===n&&(n=this.getImageData());for(var r=[],s=[],h=0;h<i;h++){void 0==s[h]&&(s[h]=[],r[h]=[]);for(var o=0;o<e;o++){void 0==s[h][o]&&(s[h][o]=[],r[h][o]=[]);var g=t+o,l=a+h;g<0||l<0||g>=n.width||l>=n.height?s[h][o]=[127,127,127,255]:(s[h][o]=this.grid[l][g].slice(0),r[h][o]=this.getPixelData(g,l,n).slice(0),s[h][o].diff(r[h][o]).length>0&&OriginalConsole.error(s[h][o],r[h][o]))}}return s},applyFilterMatrix:function(t,a=null){this.resetImage(!0);for(var e=(t=[[0,1,0],[1,-4,1],[0,1,0]]).length%2==0?[Math.floor(t.length/2),Math.ceil(t.length/2)]:[Math.floor(t.length/2)],i=Math.abs(0-Math.min.apply(null,e)),n=t[0].length%2==0?[Math.floor(t[0].length/2),Math.ceil(t[0].length/2)]:[Math.floor(t[0].length/2)],r=Math.abs(0-Math.min.apply(null,n)),s=this.getImageData(),h=this.getImageData(),o=h.width,g=(h.height,0);g<=h.data.length;g+=4){var l=Math.floor(g/4/o),d=Math.abs(g-l*o*4)/4,c=this.getMatrixFromData(d-r,l-i,t[0].length,t.length,s),m=this.filterMatrixConvolution(c,t,function(t){return t});h.data[g]=m[0],h.data[g+1]=m[1],h.data[g+2]=m[2]}return[h]},getVfromType:function(t,a,e){return"media"==this.grayScaleType?(t+a+e)/3:"grayscale"==this.grayScaleType?.3*t+.59*a+.11*e:"desaturate"==this.grayScaleType?(Math.max(t,a,e)+Math.min(t,a,e))/2:"hsv"==this.grayScaleType?Math.max(t,a,e):(t+a+e)/3},filterGray:function(){var t=this,a=t.getImageData(),e=0,i=0;t.histogram.gray=Array(256).fill(0);for(var n=0;n<a.data.length;n+=4){var r=a.data[n],s=a.data[n+1],h=a.data[n+2],o=(a.data[n+3],t.getVfromType(r,s,h));a.data[n]=o,a.data[n+1]=o,a.data[n+2]=o,t.histogram.gray[o]++,e+=o,i++}return t.statistics.average=e/i,t.statistics.totalPx=i,function(){for(var a=t.getImageData(),e=0,i=0;i<a.data.length;i+=4){var n=a.data[i],r=a.data[i+1],s=a.data[i+2],h=(a.data[i+3],t.getVfromType(n,r,s));e+=Math.pow(h-t.statistics.average,2)}t.statistics.variance=e/t.statistics.totalPx,a.data.sort((t,a)=>a-t),t.statistics.median=a.data[a.data.length/2];var o={px:null,total:0};t.histogram.gray.map(function(t,a){t>=o.total&&(o.total=t,o.px=a)}),t.statistics.moda=o.px}(),[a]},ZhangSuen:function(){for(var t=this,a=t.filterGray()[0],e=0,i=0,n=0;n<a.data.length;n+=4)for(let t=0;t<3;t++){var r=a.data[n+t]>135?255:0;a.data[n+t]=r}var s=a.width,h=[[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1],[0,-1]],o=[[[0,2,4],[2,4,6]],[[0,2,6],[0,4,6]]];function g(a,e,i){for(var n=0,r=0;r<h.length-1;r++){var s=a+h[r][1],o=e+h[r][0];255!==t.getPixelData(s,o,i)[0]&&n++}return n}function l(a,e,i){for(var n=0,r=0;r<h.length-1;r++){var s=a+h[r][1],o=e+h[r][0];if(255===t.getPixelData(s,o,i)[0]){var g=a+h[r+1][1],l=e+h[r+1][0];255!==t.getPixelData(g,l,i)[0]&&n++}}return n}function d(a,e,i,n){for(var r=0,s=o[n],g=0;g<2;g++)for(var l=0;l<s[g].length;l++){var d=h[s[g][l]],c=a+d[1],m=e+d[0];if(255===t.getPixelData(c,m,i)[0]){r++;break}}return r>1}var c=[],m=!1;do{hasChanged=!1,m=!m;for(n=0;n<=a.data.length;n+=4){e=Math.floor(n/4/s),i=Math.abs(n-e*s*4)/4;if(0===a.data[n]){var f=g(i,e,a);f<2||f>6||1===l(i,e,a)&&d(i,e,a,m?0:1)&&(c.push(n),hasChanged=!0)}}for(n=0;n<c.length;n++){var u=c[n];a.data[u]=255,a.data[u+1]=255,a.data[u+2]=255}c=[]}while(m||hasChanged);return[a]}},a}(jQuery),Application=function(t,a){function e(){this.brightness=0,this.contrast=1,this.elements={inputFile:null,contentHead:null,contentBody:null,canvasOri:null,canvasChg:null,modals:{config:null}}}return window.Pdi=a,e.prototype={renderOrigin:function(t){var e=this.elements.canvasOri.get(0);e.width=t.width,e.height=t.height,e.getContext("2d").drawImage(t,0,0),this.elements.canvasOri.parents("div.content-image:eq(0)").find(".image-result").find(".img-size").text(t.width+"x"+t.height);t=a.blankMatrix(t.width,t.height)},loadStatistics:function(){var e=a.getStatistics(),i=t(".statistics");i.removeClass("d-none"),i.find(".media span").text(e.average.toFixed(2)),i.find(".mediana span").text(e.median),i.find(".vari span").text(e.variance.toFixed(2)),i.find(".moda span").text(e.moda),i.find(".total span").text(e.totalPx)},events:function(){var t=this;t.elements.contentHead.on("click",".image-upload",function(){t.elements.inputFile.click()}),t.elements.contentHead.on("click",".reset",function(){var e=a.resetImage(!0);t.renderResults(e)}),t.elements.contentHead.on("click",".zhang_suen",function(){var e=a.ZhangSuen();t.renderResults(e)}),t.elements.inputFile.on("change",function(e){a.loadImagem(event.target.files[0],function(a){t.renderOrigin(a),setTimeout(function(){},200)})})},renderResults:function(t){for(var a in this.elements.result.html(""),t){var e=t[a],i=this.elements.modelo.clone();i.removeClass("modelo").addClass("content-image");i.find("h4").html("Resultado");var n=i.find("canvas.canvas-image-change").get(0);n.width=e.width,n.height=e.height,n.getContext("2d").putImageData(e,0,0),i.find(".image-result").find(".img-size").text(e.width+"x"+e.height),this.elements.result.append(i)}},init:function(){return this.elements.inputFile=t("#inputFile"),this.elements.contentHead=t(".main-sidebar"),this.elements.contentBody=t(".content-wrapper"),this.elements.canvasOri=this.elements.contentBody.find("#canvas-image-origin"),this.elements.canvasChg=this.elements.contentBody.find("#canvas-image-change"),this.elements.modals.config=t("div.modal#configuration"),this.elements.modelo=t(".content-wrapper .modelo"),this.elements.result=t(".content-wrapper .results"),this.events(),this}},new e}(jQuery,new PDI);Application.init();