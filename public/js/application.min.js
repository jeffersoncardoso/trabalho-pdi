/*! Application - v0.0.0 - 2019-10-16 */
var PDI=function(t){function e(){this.original=new Image,this.image=new Image,this.processes={},this.grayScaleType="media",this.grid=[],this.reset()}return e.prototype={setGrayScale:function(t){this.grayScaleType=t},reset:function(){this.statistics={average:0,median:0,variance:0,moda:0,totalPx:0},this.histogram={},this.histogram.gray=Array(256).fill(0),this.histogram.rgb={r:Array(256).fill(0),g:Array(256).fill(0),b:Array(256).fill(0)},this.grid=[]},loadImagem:function(t,e){var a=this;a.original.src=URL.createObjectURL(t),a.image.src=URL.createObjectURL(t),"function"==typeof e&&(a.image.onload=function(){e(a.image),a.resetImage(),a.convertToGrid()}),this.reset()},resetImage:function(t){t&&(this.processes={});var e=document.createElement("canvas");e.width=this.original.width,e.height=this.original.height;var a=e.getContext("2d");return a.drawImage(this.original,0,0),this.image=a.getImageData(0,0,this.original.width,this.original.height),[this.image]},getImageData:function(){var t=document.createElement("canvas");if(this.image instanceof Image){var e,a=this.image;return t.width=a.width,t.height=a.height,(e=t.getContext("2d")).drawImage(a,0,0),e.getImageData(0,0,a.width,a.height)}if(this.image instanceof ImageData)return t.width=this.image.width,t.height=this.image.height,(e=t.getContext("2d")).putImageData(this.image,0,0),e.getImageData(0,0,this.image.width,this.image.height)},getPixelData:function(t,e,a){void 0===a&&(a=this.getImageData());var i=a.width,n=(a.height,e*i*4+4*t);return[a.data[n],a.data[n+1],a.data[n+2],a.data[n+3],n]},applyFilter:function(){var t=Array.from(arguments),e=t.shift();return void 0===t&&(t={}),this.processes[e]=t,this.processImage()},processImage:function(){for(var t in this.resetImage(),this.processes){var e=this.processes[t];this.image=this[t].apply(this,e)[0]}return[this.image]},getStatistics:function(){return this.statistics},getHistogram:function(t){if("gray"==t)return this.filterGray(),this.histogram.gray;if("rgb"==t)for(var e=this.getImageData(),a=0;a<e.data.length;a+=4)histogram.r[e.data[a]]++,histogram.g[e.data[a+1]]++,histogram.b[e.data[a+2]]++},blankMatrix:function(t,e,a=255){var i=document.createElement("canvas");return i.width=t,i.height=e,i.getContext("2d").getImageData(0,0,t,e)},convertToGrid:function(){for(var t=this.getImageData(),e=this.image.width,a=(this.image.height,0),i=0,n=0;a<t.data.length;a+=4,i++)i==e&&(i=0,n++),void 0===this.grid[n]&&(this.grid[n]=[]),void 0===this.grid[n][i]&&(this.grid[n][i]=[]),this.grid[n][i]=[t.data[a],t.data[a+1],t.data[a+2],t.data[a+3],a]},showMatrix:function(t,e){if(e){var a=[];for(r=0;r<matrixData.length;r++){void 0==a[r]&&(a[r]=[]);for(var i=0;i<matrixData[0].length;i++){void 0==a[r][i]&&(a[r][i]=[]);var n=matrixData[r][i];a[r][i]="[ "+n.join(" ")+" ]",_this.showMatrix(a)}}}else for(var r=0;r<t.length;r++)console.log("[ "+t[r].join(" ")+" ]")},filterMatrixConvolution:function(t,e,a=null){for(var i=[0,0,0,0],n=0;n<t.length;n++)for(var r=0;r<t[0].length;r++){var s=t[n][r],o=e[n][r];s.map(function(t,e){i[e]+=t*o})}return"function"==typeof a&&(i=a(i)),i},getMatrixFromData:function(t,e,a,i,n){void 0===n&&(n=this.getImageData());for(var r=[],s=[],o=0;o<i;o++){void 0==s[o]&&(s[o]=[],r[o]=[]);for(var l=0;l<a;l++){void 0==s[o][l]&&(s[o][l]=[],r[o][l]=[]);var h=t+l,g=e+o;h<0||g<0||h>=n.width||g>=n.height?s[o][l]=[127,127,127,255]:(s[o][l]=this.grid[g][h].slice(0),r[o][l]=this.getPixelData(h,g,n).slice(0),s[o][l].diff(r[o][l]).length>0&&OriginalConsole.error(s[o][l],r[o][l]))}}return s},applyFilterMatrix:function(t,e=null){this.resetImage(!0);for(var a=(t=[[0,1,0],[1,-4,1],[0,1,0]]).length%2==0?[Math.floor(t.length/2),Math.ceil(t.length/2)]:[Math.floor(t.length/2)],i=Math.abs(0-Math.min.apply(null,a)),n=t[0].length%2==0?[Math.floor(t[0].length/2),Math.ceil(t[0].length/2)]:[Math.floor(t[0].length/2)],r=Math.abs(0-Math.min.apply(null,n)),s=this.getImageData(),o=this.getImageData(),l=o.width,h=(o.height,0);h<=o.data.length;h+=4){var g=Math.floor(h/4/l),d=Math.abs(h-g*l*4)/4,c=this.getMatrixFromData(d-r,g-i,t[0].length,t.length,s),m=this.filterMatrixConvolution(c,t,function(t){return t});o.data[h]=m[0],o.data[h+1]=m[1],o.data[h+2]=m[2]}return[o]},getVfromType:function(t,e,a){return"media"==this.grayScaleType?(t+e+a)/3:"grayscale"==this.grayScaleType?.3*t+.59*e+.11*a:"desaturate"==this.grayScaleType?(Math.max(t,e,a)+Math.min(t,e,a))/2:"hsv"==this.grayScaleType?Math.max(t,e,a):(t+e+a)/3},filterGray:function(){var t=this,e=t.getImageData(),a=0,i=0;t.histogram.gray=Array(256).fill(0);for(var n=0;n<e.data.length;n+=4){var r=e.data[n],s=e.data[n+1],o=e.data[n+2],l=(e.data[n+3],t.getVfromType(r,s,o));e.data[n]=l,e.data[n+1]=l,e.data[n+2]=l,t.histogram.gray[l]++,a+=l,i++}return t.statistics.average=a/i,t.statistics.totalPx=i,function(){for(var e=t.getImageData(),a=0,i=0;i<e.data.length;i+=4){var n=e.data[i],r=e.data[i+1],s=e.data[i+2],o=(e.data[i+3],t.getVfromType(n,r,s));a+=Math.pow(o-t.statistics.average,2)}t.statistics.variance=a/t.statistics.totalPx,e.data.sort((t,e)=>e-t),t.statistics.median=e.data[e.data.length/2];var l={px:null,total:0};t.histogram.gray.map(function(t,e){t>=l.total&&(l.total=t,l.px=e)}),t.statistics.moda=l.px}(),[e]},brightnessContrast:function(t,e){for(var a=t,i=e,n=this.getImageData(),r=0;r<n.data.length;r+=4)for(let t=0;t<3;t++)n.data[r+t]=n.data[r+t]*i+a,n.data[r+t]>255&&(n.data[r+t]=255),n.data[r+t]<0&&(n.data[r+t]=0);return this.image=n,[n]},negative:function(){for(var t=this.getImageData(),e=0;e<t.data.length;e+=4)for(let a=0;a<3;a++)t.data[e+a]=255-t.data[e+a];return[t]},transform:function(t,e,a){t=Math.floor(t),e=Math.floor(e);var i=this,n=[];function r(){n.push(i.blankMatrix(t,e))}r();for(var s=i.getImageData().data,o=(i.image.width,i.image.height,i.image.width,i.image.height,0),l=0,h=0;h<=n[0].data.length;h+=4){(l=h/4-t*o)==t&&o++;var g=Math.floor(a[0]*l+a[3]*o+a[6]),d=Math.floor(a[1]*l+a[4]*o+a[7]),c=h;if(g>=0&&g<=i.image.width&&d>=0&&d<=i.image.height)var m=[{newPixel:Math.floor(4*(d*i.image.width+g))}.newPixel];else m=[0];for(var f=0;f<m.length;f++){void 0===n[f]&&r();var u=m[f];n[f].data[c]=s[u],n[f].data[c+1]=s[u+1],n[f].data[c+2]=s[u+2],n[f].data[c+3]=s[u+3]}}return n},transladar:function(t,e,a,i){var n=this.image.width+e+i,r=this.image.height+t+a,s=[1,0,0,0,1,0,0,0,1];e>0&&(s[6]=-e,s[0]),t>0&&(s[7]=-t,s[0]);var o=this.transform(n,r,s);return this.image=o[0],o},resize:function(t,e){(t>=4||t<=0)&&(alert("Intervalo aceito para X [0, 4] e != 0"),t=1),(e>=4||e<=0)&&(alert("Intervalo aceito para Y [0, 4] e != 0"),e=1);var a=this.image.width*t,i=this.image.height*e,n=[1,0,0,0,1,0,0,0,1];n[0]=1/t,n[4]=1/e;var r=this.transform(a,i,n);return this.image=r[0],r},rotate:function(t){var e=this.image.width,a=this.image.height,i=Math.cos(t*Math.PI/180),n=Math.sin(t*Math.PI/180),r=[i,-n,0,n,i,0,-n*e/2-i*a/2+a/2,-i*e/2+n*a/2+e/2,1];return this.transform(e,a,r)},mirror:function(t,e){var a=this.image.width,i=this.image.height,n=[1,0,0,0,1,0,0,0,1];t>0&&(n[0]=-t,n[6]=this.image.width),e>0&&(n[4]=-e,n[7]=this.image.height);var r=this.transform(a,i,n);return this.image=r[0],r},aliasing:function(){this.getImageData().data;var t=this.blankMatrix(this.image.width,this.image.height);t.data;return t},ZhangSuen:function(){}},e}(jQuery),Application=function(t,e){function a(){this.brightness=0,this.contrast=1,this.elements={inputFile:null,contentHead:null,contentBody:null,canvasOri:null,canvasChg:null,modals:{config:null}}}return window.Pdi=e,a.prototype={renderOrigin:function(t){var a=this.elements.canvasOri.get(0);a.width=t.width,a.height=t.height,a.getContext("2d").drawImage(t,0,0),this.elements.canvasOri.parents("div.content-image:eq(0)").find(".image-result").find(".img-size").text(t.width+"x"+t.height);t=e.blankMatrix(t.width,t.height)},loadStatistics:function(){var a=e.getStatistics(),i=t(".statistics");i.removeClass("d-none"),i.find(".media span").text(a.average.toFixed(2)),i.find(".mediana span").text(a.median),i.find(".vari span").text(a.variance.toFixed(2)),i.find(".moda span").text(a.moda),i.find(".total span").text(a.totalPx)},events:function(){var a=this;a.elements.contentHead.on("click",".image-upload",function(){a.elements.inputFile.click()}),a.elements.contentHead.on("click",".reset",function(){var t=e.resetImage(!0);a.renderResults(t)});var i=!1,n=a.elements.contentHead.find('.filter-gray input[type="checkbox"]');function r(){if(i)t=e.applyFilter("filterGray");else{void 0!==e.processes.filterGray&&delete e.processes.filterGray;var t=e.processImage()}a.renderResults(t),a.loadStatistics()}n.attr("checked",i),a.elements.contentHead.on("click",".filter-gray",function(e){t(e.target).parents(".checkbox-squared").length>0?(i=!i,r(),n.attr("checked",i),e.preventDefault()):r()}),a.elements.contentHead.on("click",".transladar",function(){var t=parseInt(prompt("Transladar em top","0"))||0,i=parseInt(prompt("Transladar em left","0"))||0,n=e.applyFilter("transladar",t,i,0,0);a.renderResults(n)}),a.elements.contentHead.on("click",".resize",function(){var t=parseFloat(prompt("Redimencionar em X","0"))||0,i=parseFloat(prompt("Redimencionar em Y","0"))||0,n=e.applyFilter("resize",t,i);a.renderResults(n)});var s=a.elements.contentHead.find(".rotate label.value");function o(t){s.text(t.value);var i=e.applyFilter("rotate",t.value);a.renderResults(i)}(g=a.elements.contentHead.find("#slider_rotate").slider()).on("click",o),g.on("slideStop",o),g.on("slide",function(t){s.text(t.value)});var l=a.elements.contentHead.find(".brightness label.value");function h(t){l.text(t.value),a.brightness=t.value;var i=e.applyFilter("brightnessContrast",a.brightness,a.contrast);a.renderResults(i)}(g=a.elements.contentHead.find("#slider_brightness").slider()).on("click",h),g.on("slideStop",h),g.on("slide",function(t){l.text(t.value)});var g,d=a.elements.contentHead.find(".contrast label.value");function c(t){d.text(t.value),a.contrast=t.value;var i=e.applyFilter("brightnessContrast",a.brightness,a.contrast);a.renderResults(i)}(g=a.elements.contentHead.find("#slider_contrast").slider()).on("click",c),g.on("slideStop",c),g.on("slide",function(t){d.text(t.value)});var m=!1,f=a.elements.contentHead.find('.negative input[type="checkbox"]');function u(){if(m)t=e.applyFilter("negative");else{void 0!==e.processes.negative&&delete e.processes.negative;var t=e.processImage()}a.renderResults(t),a.loadStatistics()}f.attr("checked",m),a.elements.contentHead.on("click",".negative",function(e){t(e.target).parents(".checkbox-squared").length>0?(m=!m,u(),f.attr("checked",m),e.preventDefault()):u()}),a.elements.contentHead.on("change",'.mirror input[type="checkbox"]',function(){var t=a.elements.contentHead.find(".mirror #mirror_x").is(":checked"),i=a.elements.contentHead.find(".mirror #mirror_y").is(":checked"),n=e.applyFilter("mirror",t,i);a.renderResults(n)}),a.elements.contentHead.on("click",".zhang_suen",function(){var t=e.ZhangSuen();a.renderResults(t)}),a.elements.contentHead.on("click",".aliasing",function(){var t=e.aliasing();a.renderResults(t)}),a.elements.modals.config.on("change",".gray-type",function(){e.setGrayScale(this.value)}),a.elements.inputFile.on("change",function(t){e.loadImagem(event.target.files[0],function(t){a.renderOrigin(t),setTimeout(function(){},200)})}),a.elements.contentHead.on("click",".matrix",function(){var t=e.applyFilter("applyFilterMatrix");a.renderResults(t)})},renderResults:function(t){for(var e in this.elements.result.html(""),t){var a=t[e],i=this.elements.modelo.clone();i.removeClass("modelo").addClass("content-image");i.find("h4").html("Resultado");var n=i.find("canvas.canvas-image-change").get(0);n.width=a.width,n.height=a.height,n.getContext("2d").putImageData(a,0,0),i.find(".image-result").find(".img-size").text(a.width+"x"+a.height),this.elements.result.append(i)}},init:function(){return this.elements.inputFile=t("#inputFile"),this.elements.contentHead=t(".main-sidebar"),this.elements.contentBody=t(".content-wrapper"),this.elements.canvasOri=this.elements.contentBody.find("#canvas-image-origin"),this.elements.canvasChg=this.elements.contentBody.find("#canvas-image-change"),this.elements.modals.config=t("div.modal#configuration"),this.elements.modelo=t(".content-wrapper .modelo"),this.elements.result=t(".content-wrapper .results"),this.events(),this}},new a}(jQuery,new PDI);Application.init();